var mongoUser  = require('./init'); //Connect to the database
var gravatar = require('gravatar'); //module is used to get the Gravatar Image URL of the user
var crypto = require('crypto');

exports.login = function(email, password, callback) {
  //console.log(email);
  //find a user in the database
  mongoUser.find({email:email}, function(err,users){

    //if the specific user exists
    if(users.length != 0 ){
      //user's gredentials
      var hash_db = users[0].passWord;
      var token = users[0].token;
      var username = users[0].userName;
      //altering the pass word in order to be hashed
      var hashed_password = crypto.createHash('sha512').update(password).digest("hex");

      //var grav_url = gravatar.url(email, {s: '200', r: 'pg', d: '404'});
      //console.log(hash_db);
      //console.log(hashed_password);
      //compare password from DB with password from request's body
      if(hash_db == hashed_password){
        //login
        callback({'response':"Login Success, Welcome",'res':true,'token':token, 'username':username});
      } else {
        //fail to login
        callback({'response':"Invalid Password",'res':false});
      }
    } else {
      //fail to login because user does not exist
      callback({'response':"User not exist",'res':false});
    }
  });
}
